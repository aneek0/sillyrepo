# meta developer: Azu-nyyyyyyaaaaan
# üîê This code is licensed under CC-BY-NC Licence! - https://creativecommons.org/licenses/by-nc/4.0/

from .. import loader, utils
from datetime import datetime

@loader.tds
class RpG(loader.Module):
    """–ü–æ–ª—É—á–∞–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —É—Ä–æ–∫–æ–≤ –¥–ª—è –∫–ª–∞—Å—Å–∞ 11 A"""
    strings = {
        "name": "RpG",
        "schedule_found": "<emoji document_id=5431897022456145283>üìÜ</emoji> –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è 11 A –Ω–∞ {day}:\n{lessons}"
    }
    
    def __init__(self):
        pass
    
    # –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–≤–æ–Ω–∫–æ–≤
    lesson_times = {
        "1": {"start": "08:30", "end": "09:15"},
        "2": {"start": "09:30", "end": "10:15"},
        "3": {"start": "10:30", "end": "11:15"},
        "4": {"start": "11:30", "end": "12:15"},
        "5": {"start": "12:30", "end": "13:15"},
        "6": {"start": "13:30", "end": "14:15"},
        "7": {"start": "14:30", "end": "15:15"}
    }
    
    # –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –∫–ª–∞—Å—Å–∞ 11 A
    schedule = {
        "–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫": [
            ("1", "–ø—Ä–∞—Ü.–Ω–∞–≤—É—á.", ""),
            ("2", "–ø—Ä–∞—Ü.–Ω–∞–≤—É—á.", ""),
            ("3", "–ø—Ä–∞—Ü.–Ω–∞–≤—É—á.", ""),
            ("4", "–ø—Ä–∞—Ü.–Ω–∞–≤—É—á.", ""),
            ("5", "–ø—Ä–∞—Ü.–Ω–∞–≤—É—á.", ""),
            ("6", "–ø—Ä–∞—Ü.–Ω–∞–≤—É—á.", "")
        ],
        "–≤—Ç–æ—Ä–Ω–∏–∫": [
            ("1", "–±–µ–ª.–º–æ–≤–∞", "304"),
            ("2", "–±–µ–ª.–ª—ñ—Ç.", "304"),
            ("3", "—Ñ—ñ–∑—ñ–∫–∞", "310"),
            ("4", "–§–ö–Ü–ó", "201"),
            ("5", "–≥—ñ—Å—Ç–æ—Ä—ã—è", "302"),
            ("6", "–º–∞—Ç—ç–º–∞—Ç—ã–∫–∞", "206"),
            ("7", "–≥—Ä–∞–º–∞–¥–∞–∑–Ω.", "302")
        ],
        "—Å—Ä–µ–¥–∞": [
            ("1", "—Ä—É—Å–∫.–º–æ–≤–∞", "301"),
            ("2", "–∞–Ω–≥–ª.–º–æ–≤–∞", "309/305"),
            ("3", "—Ö—ñ–º—ñ—è", "217"),
            ("4", "–±—ñ—è–ª–æ–≥—ñ—è", "208"),
            ("5", "—Ä—É—Å–∫.–ª—ñ—Ç", "306"),
            ("6", "–º–∞—Ç—ç–º–∞—Ç—ã–∫–∞", "208"),
            ("7", "–≥—ñ—Å—Ç–æ—Ä—ã—è", "217")
        ],
        "—á–µ—Ç–≤–µ—Ä–≥": [
            ("1", "–º–∞—Ç—ç–º–∞—Ç—ã–∫–∞", "202"),
            ("2", "–±—ñ—è–ª–æ–≥—ñ—è", "208"),
            ("3", "–§–ö–Ü–ó", "201"),
            ("4", "—Ñ—ñ–∑—ñ–∫–∞", "310"),
            ("5", "–≥–µ–∞–≥—Ä–∞—Ñ—ñ—è", "301"),
            ("6", "–∞—Å—Ç—Ä–∞–Ω–æ–º—ñ—è", "310")
        ],
        "–ø—è—Ç–Ω–∏—Ü–∞": [
            ("1", "—Ö—ñ–º—ñ—è", "217"),
            ("2", "–º–∞—Ç—ç–º–∞—Ç—ã–∫–∞", "202"),
            ("3", "–∞–Ω–≥–ª.–º–æ–≤–∞/—ñ–Ω—Ñ.", "6/309"),
            ("4", "–±–µ–ª.–º–æ–≤–∞", "304"),
            ("5", "—ñ–Ω—Ñ./–∞–Ω–≥–ª.–º–æ–≤–∞", "309/305"),
            ("6", "—Ä—É—Å–∫.–ª—ñ—Ç.", "307"),
            ("7", "–§–ö–Ü–ó", "201")
        ]
    }
    
    def get_day_name(self, day_num):
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–Ω—è –Ω–µ–¥–µ–ª–∏ –Ω–∞ –±–µ–ª–æ—Ä—É—Å—Å–∫–æ–º"""
        days = ["–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫", "–≤—Ç–æ—Ä–Ω–∏–∫", "—Å—Ä–µ–¥–∞", "—á–µ—Ç–≤–µ—Ä–≥", "–ø—è—Ç–Ω–∏—Ü–∞", "—Å—É–±–±–æ—Ç–∞", "–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ"]
        return days[day_num] if 0 <= day_num < 7 else "–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫"
    
    def get_schedule_day(self):
        """–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥–Ω—è –Ω–µ–¥–µ–ª–∏ –∏ –≤—Ä–µ–º–µ–Ω–∏"""
        now = datetime.now()
        weekday = now.weekday()  # 0 = –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, 6 = –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ
        current_time = now.strftime("%H:%M")
        
        # –ï—Å–ª–∏ —Å—É–±–±–æ—Ç–∞ (5) –∏–ª–∏ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ (6) - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫
        if weekday >= 5:
            return 0  # –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫
        
        # –ï—Å–ª–∏ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫-–ø—è—Ç–Ω–∏—Ü–∞ (0-4)
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–∫–æ–Ω—á–∏–ª—Å—è –ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π —É—Ä–æ–∫ (–ø–æ—Å–ª–µ 15:15)
        last_lesson_end = "15:15"
        if current_time > last_lesson_end:
            # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å
            next_day = (weekday + 1) % 5  # 0-4 (–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫-–ø—è—Ç–Ω–∏—Ü–∞)
            return next_day
        else:
            # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
            return weekday
    
    async def rpgcmd(self, message):
        """–ö–æ–º–∞–Ω–¥–∞ .rpg - –ø–æ–ª—É—á–∞–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –∫–ª–∞—Å—Å–∞ 11 A"""
        args = utils.get_args_raw(message).lower().strip()
        
        # –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω –∞—Ä–≥—É–º–µ–Ω—Ç - –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ
        if args and args in self.schedule:
            day_name = args
        else:
            # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–µ–Ω—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
            schedule_day_num = self.get_schedule_day()
            day_name = self.get_day_name(schedule_day_num)
        
        if day_name not in self.schedule:
            await utils.answer(message, f"<emoji document_id=5210952531676504517>‚ùå</emoji> –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ {day_name} –Ω–µ –Ω–∞–π–¥–µ–Ω–æ!")
            return
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ —É—Ä–æ–∫–æ–≤
        lessons_list = []
        for lesson_num, subject, room in self.schedule[day_name]:
            time_info = self.lesson_times.get(lesson_num, {"start": "", "end": ""})
            room_info = f" ({room})" if room else ""
            lessons_list.append(
                f"{lesson_num} —É—Ä–æ–∫ ({time_info['start']}-{time_info['end']}): {subject}{room_info}"
            )
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç
        reply = self.strings["schedule_found"].format(
            day=day_name.capitalize(),
            lessons="\n".join(lessons_list)
        )
        await utils.answer(message, reply)

